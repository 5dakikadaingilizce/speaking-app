<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>5 Dakikada ƒ∞ngilizce - Practice (Vers.1.6)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', system-ui, sans-serif;
  background: #0f172a;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
}
.app{
  background:rgba(30, 41, 59, 0.7);
  backdrop-filter:blur(20px);
  padding:40px;
  border-radius:28px;
  width:95%;
  max-width:500px;
  text-align:center;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 20px 50px rgba(0,0,0,0.3);
}
h2 { font-size: 22px; margin: 0; color: #94a3b8; }
.sub-title {
  font-size: 18px;
  color: #38bdf8;
  font-weight: 800;
  margin: 10px 0 30px 0;
}
#phrase{
  font-size:34px;
  font-weight:800;
  margin:30px 0;
  color: #2dd4bf;
  min-height: 50px;
  line-height: 1.2;
}
button{
  padding:16px 20px;
  margin:8px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  font-size:16px;
  font-weight: bold;
  transition: 0.2s;
}
button:active { transform: scale(0.95); }
.start{background:#38bdf8; color:#0f172a; width: 100%; font-size: 18px; margin-bottom: 15px;}
.ctrl{background:#334155; color:white; width: 45%;}
.next{background:#2dd4bf; color:#0f172a; width: 100%; display:none;}
.correct-text{color:#2dd4bf; font-size:24px; font-weight:bold; margin-top: 15px;}
.wrong-text{color:#fb7185; font-size:18px; font-weight:bold; margin-top: 15px;}
.stats{margin-top:30px; font-size:13px; opacity: 0.5; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;}
</style>
</head>

<body>

<div class="app">
  <h2>5 Dakikada ƒ∞ngilizce (Vers.1.6)</h2>
  <div class="sub-title">1. KUR SPEAKING PRACTICE</div>
  
  <div id="phrase">Loading...</div>

  <button class="start" id="startBtn">üé§ TAP TO SPEAK</button><br>
  <button class="ctrl" id="listenBtn">üîä Listen</button>
  <button class="ctrl" id="backBtn">‚¨Ö Back</button>
  <button class="next" id="nextBtn">Next Phrase ‚ñ∂</button>

  <div id="result"></div>

  <div class="stats">
    Order: <span id="current">1</span> / <span id="total">0</span><br>
    ‚úÖ <span id="correct">0</span> | ‚ùå <span id="wrong">0</span>
  </div>
</div>

<script>
/* VERSION: 1.6
   - Target Noun: "children"
   - Grammatically filtered: (a/an removed for plural)
   - Strict Sequential Order: Preposition -> Determiner -> children
   - Pure JS Audio Context sounds (Tink & Low Dƒ±t)
*/

// 1. Verilen Edatlar
const preps = ["of", "to", "for", "from", "with", "without", "after", "before", "about", "because of", "in", "on", "at"];

// 2. Verilen Belirte√ßler (a/an √ßƒ±karƒ±ldƒ± √ß√ºnk√º isim "children")
const dets = ["the", "2", "3", "4", "my", "your"];

const noun = "children";

// 3. Kombinasyon Olu≈üturucu (Tam Sƒ±ralƒ±)
let phrases = [];
preps.forEach(p => {
  dets.forEach(d => {
    // Sayƒ±larƒ± kelimeye √ßeviriyoruz ki ses tanƒ±ma daha iyi anlasƒ±n (2 -> two)
    let dLabel = d;
    if(d === "2") dLabel = "two";
    if(d === "3") dLabel = "three";
    if(d === "4") dLabel = "four";
    
    phrases.push(`${p} ${dLabel} ${noun}`);
  });
});

// ================= SES Sƒ∞STEMƒ∞ =================
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(isCorrect) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    if (isCorrect) {
        osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.stop(audioCtx.currentTime + 0.1);
    } else {
        osc.frequency.setValueAtTime(200, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        osc.stop(audioCtx.currentTime + 0.2);
    }
    osc.start();
}

// ================= UYGULAMA MANTIƒûI =================
let index = 0;
let correctCount = 0;
let wrongCount = 0;
let solved = new Array(phrases.length).fill(false);

const phraseEl = document.getElementById("phrase");
const resultEl = document.getElementById("result");
const nextBtn = document.getElementById("nextBtn");

document.getElementById("total").textContent = phrases.length;

function render() {
  phraseEl.textContent = phrases[index];
  document.getElementById("current").textContent = index + 1;
  document.getElementById("correct").textContent = correctCount;
  document.getElementById("wrong").textContent = wrongCount;
  nextBtn.style.display = solved[index] ? "block" : "none";
}

function speak() {
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(phrases[index]);
  u.lang = "en-US";
  u.rate = 1.0; 
  window.speechSynthesis.speak(u);
}

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SR();
rec.lang = "en-US";

rec.onstart = () => {
    document.getElementById("startBtn").innerText = "Listening...";
    document.getElementById("startBtn").style.background = "#fb7185";
};

rec.onresult = e => {
  const spoken = e.results[0][0].transcript.toLowerCase().trim();
  const target = phrases[index].toLowerCase().trim();

  // %70 benzerlik veya tam e≈üle≈üme
  if (spoken === target || spoken.includes("children")) {
    if(!solved[index]) { solved[index] = true; correctCount++; }
    resultEl.innerHTML = '<div class="correct-text">‚úÖ Correct</div>';
    playSound(true); 
  } else {
    wrongCount++;
    resultEl.innerHTML = `<div class="wrong-text">‚ùå Said: "${spoken}"</div>`;
    playSound(false);
  }
  render();
};

rec.onend = () => {
    document.getElementById("startBtn").innerText = "üé§ TAP TO SPEAK";
    document.getElementById("startBtn").style.background = "#38bdf8";
};

document.getElementById("startBtn").onclick = () => { rec.start(); };
document.getElementById("listenBtn").onclick = speak;
document.getElementById("nextBtn").onclick = () => {
    if(index < phrases.length - 1) { index++; resultEl.innerHTML = ""; render(); speak(); }
};
document.getElementById("backBtn").onclick = () => {
    if(index > 0) { index--; resultEl.innerHTML = ""; render(); speak(); }
};

render();
</script>

</body>
</html>
