<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>5 Dakikada ƒ∞ngilizce - V.2.4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <style>
        /* MEVCUT RENK DEƒûƒ∞≈ûKENLERƒ∞ */
        :root { 
            --bg-dark: #0f172a; 
            --card-bg: rgba(30, 41, 59, 0.7); 
            --primary: #38bdf8; 
            --secondary: #2dd4bf; 
            --accent: #fb7185; 
            --text-main: #f8fafc; 
            --logo-grad: linear-gradient(90deg, #ff4d4d, #f97316); 
        }

        /* 1. ARKA PLAN REVƒ∞ZESƒ∞ */
        body { 
            margin: 0; 
            font-family: 'Inter', sans-serif; 
            background: radial-gradient(circle at top right, #1e293b, #0f172a); 
            min-height: 100dvh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            color: var(--text-main); 
            overflow: hidden; 
            padding: 10px; 
            box-sizing: border-box; 
        }

        .v-tag { position: absolute; top: 10px; right: 10px; font-size: 10px; color: rgba(255,255,255,0.3); background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); z-index: 100; }
        .material-symbols-rounded { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; vertical-align: middle; }

        /* 2. ANASAYFA KART TASARIMI REVƒ∞ZESƒ∞ */
        #entry-page { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            width: 100%; 
            max-height: 95vh; 
            overflow-y: auto; 
            padding-bottom: 20px;
        }

        .main-title-white { font-size: 22px; font-weight: 900; color: white; margin-bottom: 5px; letter-spacing: -0.5px; }

        #lesson-list-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lesson-card { 
            background: var(--card-bg); 
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px; 
            border-radius: 24px; 
            width: 85%; 
            max-width: 300px; 
            margin: 10px; 
            border: 1px solid rgba(255,255,255,0.08); 
            cursor: pointer; 
            text-align: center; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .lesson-card:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(45, 55, 75, 0.9);
            border-color: #f97316; /* Logodaki turuncu tonu */
            box-shadow: 0 15px 30px rgba(0,0,0,0.4);
        }

        .lesson-card h3 {
            margin: 0 0 8px 0;
            font-size: 1.3rem;
            color: #f97316;
            font-weight: 800;
        }

        .lesson-desc {
            font-size: 12px;
            color: #94a3b8;
            font-weight: 500;
            line-height: 1.4;
        }

        /* DERS ƒ∞√áƒ∞ EKRAN STƒ∞LLERƒ∞ (Mevcut yapƒ±n korundu) */
        #app-screen { display: none; width: 100%; max-width: 400px; max-height: 98dvh; flex-direction: column; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; width: 100%; }
        .nav-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; height: 40px; padding: 0 12px; font-size: 11px; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; gap: 6px; }
        .app-box { background: var(--card-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); padding: 20px; border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6); position: relative; text-align: center; }
        .app-logo { width: 60px; height: 60px; margin: 0 auto 5px auto; display: block; }
        .sub-title-white { font-size: 12px; color: white; font-weight: bold; margin-bottom: 2px; }
        .lesson-title-grad { background: var(--logo-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; font-size: 20px; margin-bottom: 4px; }
        .lesson-sub-white { color: white; font-size: 11px; font-weight: 500; margin-bottom: 10px; }
        .phrase-container { min-height: 90px; display: flex; flex-direction: column; justify-content: center; margin: 10px 0; text-align: center; }
        #phrase-tr { font-size: 24px; font-weight: 800; color: var(--secondary); }
        #phrase-en { font-size: 17px; color: #94a3b8; margin-top: 5px; font-style: italic; opacity: 0; transition: 0.3s; }
        #phrase-en.visible { opacity: 1; }
        .start { background: linear-gradient(135deg, #38bdf8, #0ea5e9); color: #0f172a; width: 100%; padding: 15px; border-radius: 18px; font-size: 16px; font-weight: 800; border: none; cursor: pointer; }
        .recording { background: #fb7185 !important; }
        .ctrl-container { display: flex; gap: 6px; margin: 12px 0; flex-wrap: wrap; }
        .ctrl { background: rgba(51, 65, 85, 0.7); color: white; flex: 1; padding: 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); font-weight: 600; font-size: 11px; }
        .btn-toggle { width: 100%; background: rgba(56, 189, 248, 0.2); color: var(--primary); border: 1px solid var(--primary); margin-bottom: 4px; }
        #result { font-size: 14px; font-weight: 700; height: 35px; margin: 5px 0; }
        .stats { margin-top: 8px; font-size: 7px; color: #94a3b8; background: rgba(15, 23, 42, 0.4); padding: 10px; border-radius: 18px; display: flex; justify-content: space-between; gap: 2px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .stat-label-row { display: flex; align-items: center; gap: 3px; margin-bottom: 2px; }
        .stat-label-row .material-symbols-rounded { font-size: 12px; }
        .stat-val { color: var(--primary); font-weight: 800; font-size: 12px; }
        .restart-overlay { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); border-radius: 30px; flex-direction: column; justify-content: center; align-items: center; z-index: 50; }
        .restart-overlay.active { display: flex; }
        .lesson-card.disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; filter: grayscale(1); }
    </style>
</head>
<body>

<div class="v-tag">V.2.4</div>

<div id="entry-page">
    <img src="logo.png" style="width: 80px; margin-bottom: 10px;">
    <div class="main-title-white">5 Dakikada ƒ∞ngilizce</div>
    <h1 style="background: var(--logo-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 26px; margin: 5px 0 20px 0; font-weight: 900;">Select Lesson</h1>
    <div id="lesson-list-container"></div>
</div>

<div id="app-screen">
    <div class="top-bar">
        <button class="nav-btn" onclick="goHome()">
            <span class="material-symbols-rounded">home</span> HOME
        </button>
        <button class="nav-btn" onclick="resetToStart()">
            <span class="material-symbols-rounded">refresh</span> RESTART
        </button>
    </div>
    <div class="app-box">
        <div id="restartOverlay" class="restart-overlay">
            <h2 style="color:white;">Completed! üèÜ</h2>
            <button class="start" onclick="resetToStart()">RESTART</button>
        </div>
        <img src="logo.png" class="app-logo">
        <div class="sub-title-white">5 Dakikada ƒ∞ngilizce</div>
        <div id="lessonTitle" class="lesson-title-grad">#Lesson 1</div>
        <div id="lessonSubTitle" class="lesson-sub-white">Y√ºkleniyor...</div>
        <div class="phrase-container">
            <div id="phrase-tr">...</div>
            <div id="phrase-en">...</div>
        </div>
        <button class="start" id="startBtn">TAP TO SPEAK</button>
        <div class="ctrl-container">
            <button class="ctrl btn-toggle" id="toggleBtn">SHOW ENGLISH</button>
            <button class="ctrl" id="passBtn" style="color:var(--accent)">PASS</button>
            <button class="ctrl" id="listenBtn">LISTEN</button>
            <div style="display:flex; width:100%; gap:6px;">
                <button class="ctrl" id="backBtn">‚Üê BACK</button>
                <button class="ctrl" id="nextBtn">NEXT ‚Üí</button>
            </div>
        </div>
        <div id="result"></div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-label-row">ORDER <span class="material-symbols-rounded">assistant_navigation</span></div>
                <span id="current" class="stat-val">1</span>
            </div>
            <div class="stat-item">
                <div class="stat-label-row">CORRECT <span class="material-symbols-rounded" style="color:var(--secondary)">task_alt</span></div>
                <span id="correct" class="stat-val" style="color:var(--secondary)">0</span>
            </div>
            <div class="stat-item">
                <div class="stat-label-row">PASS <span class="material-symbols-rounded" style="color:var(--accent)">keyboard_double_arrow_right</span></div>
                <span id="passedCount" class="stat-val" style="color:var(--accent)">0</span>
            </div>
            <div class="stat-item">
                <div class="stat-label-row">REMAIN <span class="material-symbols-rounded" style="color:#f97316">hourglass_bottom</span></div>
                <span id="remaining" class="stat-val" style="color:#f97316">0</span>
            </div>
        </div>
    </div>
</div>

<script>
/* JAVASCRIPT KODLARI AYNI BIRAKILDI */
let allLessonsData = [];
let index = 0, correctCount = 0, passedCount = 0, isListening = false, showEn = false, autoMode = false;
let currentList = [];
let activeLessonId = null;

fetch('data.json')
    .then(res => res.json())
    .then(data => {
        allLessonsData = data;
        renderLessonMenu();
    });

function renderLessonMenu() {
    const container = document.getElementById('lesson-list-container');
    container.innerHTML = "";
    allLessonsData.forEach(lesson => {
        const card = document.createElement('div');
        const isAvailable = lesson.file ? true : false;
        card.className = 'lesson-card' + (!isAvailable ? ' disabled' : '');
        card.onclick = () => { if(isAvailable) startLesson(lesson); };
        card.innerHTML = `<h3>${lesson.title}</h3><div class="lesson-desc">${!isAvailable ? 'Coming Soon' : lesson.subTitle}</div>`;
        container.appendChild(card);
    });
}

function startLesson(lesson) {
    fetch(lesson.file)
        .then(res => res.json())
        .then(contentData => {
            activeLessonId = lesson.id;
            currentList = [...contentData]; 
            const saved = localStorage.getItem('lesson_progress_' + activeLessonId);
            if(saved) {
                const progress = JSON.parse(saved);
                index = progress.index;
                correctCount = progress.correctCount;
                passedCount = progress.passedCount;
            } else {
                index = 0; correctCount = 0; passedCount = 0;
            }
            document.getElementById("lessonTitle").innerText = lesson.title;
            document.getElementById("lessonSubTitle").innerText = lesson.subTitle;
            document.getElementById("entry-page").style.display = "none";
            document.getElementById("app-screen").style.display = "flex";
            render();
        })
        .catch(err => alert("Ders dosyasƒ± y√ºklenemedi!"));
}

function saveProgress() {
    if(activeLessonId) {
        const progress = { index, correctCount, passedCount };
        localStorage.setItem('lesson_progress_' + activeLessonId, JSON.stringify(progress));
    }
}

function render() {
    if(index >= currentList.length) {
        document.getElementById("restartOverlay").classList.add("active");
        return;
    }
    document.getElementById("phrase-tr").textContent = currentList[index].tr;
    document.getElementById("phrase-en").textContent = currentList[index].en;
    document.getElementById("phrase-en").classList.toggle("visible", showEn);
    document.getElementById("toggleBtn").innerText = showEn ? "HIDE ENGLISH" : "SHOW ENGLISH";
    document.getElementById("current").textContent = index + 1;
    document.getElementById("correct").textContent = correctCount;
    document.getElementById("passedCount").textContent = passedCount;
    document.getElementById("remaining").textContent = currentList.length - (index + 1);
    saveProgress();
}

function playBeep(isCorrect) {
    try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const g = ctx.createGain();
        osc.connect(g); g.connect(ctx.destination);
        osc.frequency.value = isCorrect ? 800 : 150;
        g.gain.setValueAtTime(0.2, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);
        osc.start(); osc.stop(ctx.currentTime + 0.3);
    } catch(e) {}
}

function speak() {
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(currentList[index].en);
    u.lang = "en-US"; u.rate = 0.8;
    const voices = window.speechSynthesis.getVoices();
    const v = voices.find(x => x.name.includes("Google") && x.lang === "en-US") || voices.find(x => x.lang.startsWith("en-US")) || voices[0];
    if(v) u.voice = v;
    window.speechSynthesis.speak(u);
}

const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SR();
rec.lang = "en-US";
rec.continuous = true;

rec.onstart = () => { isListening = true; document.getElementById("startBtn").innerText = "LISTENING..."; document.getElementById("startBtn").classList.add("recording"); };

rec.onresult = e => {
    const spoken = e.results[e.results.length - 1][0].transcript.toLowerCase().trim();
    const target = currentList[index].en.toLowerCase().trim();
    if(spoken === target || spoken.includes(target)) {
        correctCount++;
        playBeep(true);
        document.getElementById("result").innerHTML = "<span style='color:var(--secondary)'>EXCELLENT! ‚úÖ</span>";
        setTimeout(() => { nextWord(); if(!autoMode) rec.stop(); }, 800);
    } else {
        playBeep(false);
        document.getElementById("result").innerHTML = `<span style='color:var(--accent)'>TRY AGAIN ‚ùå</span>`;
    }
};

rec.onend = () => { if(autoMode) rec.start(); else { isListening = false; document.getElementById("startBtn").innerText = "TAP TO SPEAK"; document.getElementById("startBtn").classList.remove("recording"); } };

function goHome() { autoMode = false; try { rec.stop(); } catch(e) {} document.getElementById("app-screen").style.display = "none"; document.getElementById("entry-page").style.display = "flex"; }

function resetToStart() {
    if(confirm("Ders sƒ±fƒ±rlanacak. Emin misiniz?")) {
        index = 0; correctCount = 0; passedCount = 0;
        localStorage.removeItem('lesson_progress_' + activeLessonId);
        document.getElementById("restartOverlay").classList.remove("active");
        render();
        document.getElementById("result").innerHTML = "";
    }
}

function nextWord() { if(index < currentList.length - 1) { index++; showEn = false; render(); document.getElementById("result").innerHTML = ""; } else { document.getElementById("restartOverlay").classList.add("active"); } }

document.getElementById("startBtn").onclick = () => { if(!isListening) { autoMode = true; rec.start(); } else { autoMode = false; rec.stop(); } };
document.getElementById("listenBtn").onclick = speak;
document.getElementById("toggleBtn").onclick = () => { showEn = !showEn; render(); };
document.getElementById("nextBtn").onclick = nextWord;
document.getElementById("backBtn").onclick = () => { if(index > 0) { index--; render(); } };
document.getElementById("passBtn").onclick = () => { passedCount++; currentList.push(currentList[index]); nextWord(); };
window.speechSynthesis.onvoiceschanged = () => { window.speechSynthesis.getVoices(); };
</script>
</body>
</html>
